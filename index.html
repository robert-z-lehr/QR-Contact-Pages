<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Contact QR (vCard)</title>

<!-- QRCodeStyling (modern, stylized circular QR) -->
<script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.5.0/lib/qr-code-styling.js"></script>

<style>
  :root { --gap:16px; --radius:14px; }
  * { box-sizing:border-box; font-family:ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  body { margin:0; padding:24px; background:#0b0c10; color:#e5e7eb; }
  h1 { margin:0 0 12px; font-size:1.5rem; }
  h2 { margin:0 0 12px; }
  .wrap { display:grid; gap:16px; max-width:900px; margin:0 auto; }
  .card { background:#111827; border:1px solid #1f2937; padding:16px; border-radius:var(--radius); }
  .grid { display:grid; gap:12px; }
  .two { grid-template-columns:repeat(2,minmax(0,1fr)); }
  @media (max-width:900px) { .two { grid-template-columns:1fr; } }
  label { display:block; font-size:.9rem; color:#cbd5e1; }
  input, textarea {
    width:100%; padding:10px 12px; border-radius:10px;
    border:1px solid #374151; background:#0b1220; color:#e5e7eb;
  }
  textarea { min-height:70px; resize:vertical; }
  .row { display:grid; gap:10px; grid-template-columns:repeat(2,1fr); }
  .btn {
    background:#2563eb; border:none; color:white; padding:10px 14px;
    border-radius:10px; cursor:pointer; font-weight:600;
  }
  .btn.secondary { background:#374151; }
  .small { font-size:.9rem; color:#9ca3af; }
  .qr-box { display:flex; justify-content:center; padding:20px; }
  .controls { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }

  .square-container, .circle-container { display:none; }
  .active { display:block; }

  footer { color:#9ca3af; margin-top:30px; font-size:.85rem; }
  code.inline { background:#0b1220; padding:2px 6px; border-radius:6px; border:1px solid #1f2937; }
</style>
</head>


<body>
<div class="wrap">

  <!-- Header -->
  <header class="card">
    <h1>Contact QR (vCard)</h1>
    <p class="small">Fill info → Build vCard → Upload <code class="inline">contact.vcf</code> → QR links to it.</p>
  </header>

  <!-- vCard Builder -->
  <section class="card">
    <h2>vCard Details</h2>

    <div class="grid">

      <div class="row">
        <div>
          <label for="fn">Full Name (FN)</label>
          <input id="fn" value="Robert Lehr" />
        </div>
        <div>
          <label for="org">Organization (ORG)</label>
          <input id="org" value="University of Texas at Austin" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="title">Title (TITLE)</label>
          <input id="title" value="Ph.D. Student - Civil Engineering | Sustainable Systems Engineering" />
        </div>
        <div>
          <label for="tel">Phone (CELL)</label>
          <input id="tel" value="+1-512-922-0392" />
        </div>
      </div>

      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" value="robert.z.lehr@utexas.edu" />
        </div>
        <div>
          <label for="url">Website (URL)</label>
          <input id="url" value="https://www.linkedin.com/in/robert-z-lehr/" />
        </div>
      </div>

      <div>
        <label for="note">Short description (NOTE)</label>
        <textarea id="note">Engineer, designer, and systems thinker focused on sustainable infrastructure, place-making, human-centered design, and improving long-term community resilience.</textarea>
      </div>

      <button id="buildVcf" class="btn">Build vCard file</button>
      <a id="dlVcf" class="btn secondary" href="#" download="contact.vcf" style="pointer-events:none;opacity:0.6;">Download contact.vcf</a>

    </div>
  </section>


  <!-- QR Generator -->
  <section class="card">
    <h2>QR Code</h2>

    <div class="grid two" style="width:100%; max-width:780px;">
      <div>
        <label for="targetUrl">Override Target URL (optional)</label>
        <input id="targetUrl" placeholder="" />
        <p class="small">If blank, auto-uses <code class="inline">[this page]/contact.vcf</code></p>
      </div>

      <div class="row">
        <div>
          <label for="qrSize">Size</label>
          <select id="qrSize">
            <option>256</option>
            <option selected>320</option>
            <option>384</option>
            <option>448</option>
          </select>
        </div>
        <div>
          <label for="qrStyle">Style</label>
          <select id="qrStyle">
            <option value="circle" selected>Circle</option>
            <option value="square">Square</option>
          </select>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn" id="apply">Apply</button>
      <a class="btn secondary" id="openVcf" target="_blank" rel="noopener">Open vCard</a>
    </div>

    <!-- Square QR -->
    <div id="squareContainer" class="qr-box square-container">
      <div id="qrSquare"></div>
    </div>

    <!-- Circular QR (Option D) -->
    <div id="circleContainer" class="qr-box circle-container active">
      <div id="qrCircle"></div>
    </div>

    <div class="controls">
      <button class="btn" id="dlPng">Download PNG</button>
      <button class="btn secondary" id="dlSvg">Download SVG</button>
    </div>

  </section>

  <footer>
    Ensure <code class="inline">contact.vcf</code> is committed to your GitHub Pages repo.
  </footer>
</div>


<!-- Main Script -->
<script>
/* ---------------------------
   1. Build vCard string
--------------------------- */
function buildVCard(data) {
  const esc = s => String(s||"")
    .replace(/\\/g,"\\\\")
    .replace(/\n/g,"\\n")
    .replace(/,/g,"\\,")
    .replace(/;/g,"\\;");

  const parts = data.fn.split(" ");
  const first = parts.slice(0,-1).join(" ");
  const last  = parts.slice(-1)[0] || "";

  return [
    "BEGIN:VCARD",
    "VERSION:3.0",
    `FN:${esc(data.fn)}`,
    `N:${esc(last)};${esc(first)};;;`,
    `TITLE:${esc(data.title)}`,
    `EMAIL:${esc(data.email)}`,
    `TEL:${esc(data.tel)}`,
    `ORG:${esc(data.org)}`,
    `URL:${esc(data.url)}`,
    `NOTE:${esc(data.note)}`,
    "END:VCARD"
  ].join("\r\n");
}

/* ---------------------------
   2. GitHub Pages URL
--------------------------- */
function baseUrl() {
  const { origin, pathname } = window.location;
  const folder = pathname.endsWith("/") ? pathname : pathname.replace(/\/[^/]+$/, "/");
  return origin + folder;
}

function targetUrl() {
  const manual = (document.getElementById("targetUrl").value||"").trim();
  return manual || baseUrl() + "contact.vcf";
}

/* ---------------------------
   3. QRCodeStyling Instances
--------------------------- */
let qrCircle = new QRCodeStyling({
  width: 320,
  height: 320,
  type: "svg",
  data: baseUrl() + "contact.vcf",
  dotsOptions: { type: "dots", color:"#000" },
  cornersSquareOptions: { type:"dot", color:"#000" },
  cornersDotOptions: { type:"dot", color:"#000" },
  backgroundOptions: { color:"transparent" }
});

let qrSquare = new QRCodeStyling({
  width: 320,
  height: 320,
  type: "svg",
  data: baseUrl() + "contact.vcf",
  dotsOptions: { type: "square", color:"#000" },
  cornersSquareOptions: { type:"square", color:"#000" },
  cornersDotOptions: { type:"square", color:"#000" },
  backgroundOptions: { color:"transparent" }
});

/* Attach to DOM */
qrCircle.append(document.getElementById("qrCircle"));
qrSquare.append(document.getElementById("qrSquare"));

/* ---------------------------
   4. Render updated QR
--------------------------- */
function renderQr() {
  const url = targetUrl();
  const size = parseInt(document.getElementById("qrSize").value,10);

  qrCircle.update({ data:url, width:size, height:size });
  qrSquare.update({ data:url, width:size, height:size });

  document.getElementById("openVcf").href = url;
}

/* ---------------------------
   5. Toggle style
--------------------------- */
function applyStyle() {
  const style = document.getElementById("qrStyle").value;

  document.getElementById("circleContainer").classList.remove("active");
  document.getElementById("squareContainer").classList.remove("active");

  if (style === "square") {
    document.getElementById("squareContainer").classList.add("active");
  } else {
    document.getElementById("circleContainer").classList.add("active");
  }
}

/* ---------------------------
   6. vCard builder
--------------------------- */
document.getElementById("buildVcf").addEventListener("click", () => {
  const data = {
    fn: document.getElementById("fn").value,
    org: document.getElementById("org").value,
    title: document.getElementById("title").value,
    tel: document.getElementById("tel").value,
    email: document.getElementById("email").value,
    url: document.getElementById("url").value,
    note: document.getElementById("note").value
  };

  const text = buildVCard(data);
  const blob = new Blob([text], { type:"text/vcard;charset=utf-8" });
  const url  = URL.createObjectURL(blob);

  const dl = document.getElementById("dlVcf");
  dl.href = url;
  dl.style.pointerEvents = "auto";
  dl.style.opacity = "1";
  dl.textContent = "Download contact.vcf";
});

/* ---------------------------
   7. Downloads: PNG / SVG
--------------------------- */
document.getElementById("dlPng").addEventListener("click", async () => {
  const style = document.getElementById("qrStyle").value;
  const qr = style === "square" ? qrSquare : qrCircle;

  const blob = await qr.getRawData("png");
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "contact-qr.png";
  link.click();
});

document.getElementById("dlSvg").addEventListener("click", async () => {
  const style = document.getElementById("qrStyle").value;
  const qr = style === "square" ? qrSquare : qrCircle;

  const blob = await qr.getRawData("svg");
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = "contact-qr.svg";
  link.click();
});

/* ---------------------------
   Initial load
--------------------------- */
renderQr();
applyStyle();

document.getElementById("apply").addEventListener("click", () => {
  renderQr();
  applyStyle();
});

</script>

</body>
</html>
