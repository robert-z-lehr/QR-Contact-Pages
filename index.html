<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>QR: Contact Card + Profiles</title>
  <meta name="description" content="Generate and download QR codes for a vCard contact, LinkedIn, and GitHub. Host on GitHub Pages." />
  <style>
    :root { --gap: 16px; --radius: 16px; }
    * { box-sizing: border-box; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }
    body { margin: 0; padding: 24px; background: #0b0c10; color: #e5e7eb; }
    header { display: grid; gap: 8px; margin-bottom: 24px; }
    h1 { margin: 0; font-size: 1.5rem; }
    .grid { display: grid; gap: var(--gap); }
    .two { grid-template-columns: repeat(2, minmax(0, 1fr)); }
    .three { grid-template-columns: repeat(3, minmax(0, 1fr)); }
    @media (max-width: 900px) { .two, .three { grid-template-columns: 1fr; } }
    .card { background: #111827; border: 1px solid #1f2937; border-radius: var(--radius); padding: 16px; }
    label { display: block; font-size: 0.9rem; color: #cbd5e1; margin-top: 8px; }
    input, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border: 1px solid #374151; background: #0b1220; color: #e5e7eb; }
    textarea { min-height: 70px; resize: vertical; }
    .row { display: grid; gap: 10px; grid-template-columns: repeat(2,1fr); }
    .btn { background: #2563eb; border: none; color: white; padding: 10px 14px; border-radius: 10px; cursor: pointer; font-weight: 600; }
    .btn.secondary { background: #374151; }
    .btn:disabled { opacity: .6; cursor: not-allowed; }
    .qr-wrap { display: grid; gap: 8px; justify-items: center; text-align: center; }
    .qr-box { background: white; padding: 12px; border-radius: 12px; }
    .small { font-size: .9rem; color: #9ca3af; }
    code.inline { background: #0b1220; padding: 2px 6px; border-radius: 6px; border: 1px solid #1f2937; }
  </style>
</head>
<body>
  <header>
    <h1>QR: Contact Card + Profiles</h1>
    <p class="small">This page creates three QR codes: (1) downloadable vCard (<span class="small">adds to iOS/Android Contacts</span>), (2) LinkedIn, and (3) GitHub. You can download each PNG to use as a lock-screen wallpaper or print asset.</p>
  </header>

  <section class="grid two">
    <div class="card">
      <h2>1) Contact details → <code class="inline">.vcf</code></h2>
      <div class="row">
        <div>
          <label for="fn">Full Name (FN)</label>
          <input id="fn" placeholder="Ada Lovelace" value="Ada Lovelace" />
        </div>
        <div>
          <label for="org">Organization (ORG)</label>
          <input id="org" placeholder="Analytical Engines" value="Analytical Engines" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="title">Title (TITLE)</label>
          <input id="title" placeholder="Engineer" value="Engineer" />
        </div>
        <div>
          <label for="tel">Phone (CELL)</label>
          <input id="tel" placeholder="+1-555-123-4567" value="+1-555-123-4567" />
        </div>
      </div>
      <div class="row">
        <div>
          <label for="email">Email</label>
          <input id="email" placeholder="ada@example.com" value="ada@example.com" />
        </div>
        <div>
          <label for="url">Website (URL)</label>
          <input id="url" placeholder="https://example.com" value="https://example.com" />
        </div>
      </div>
      <label for="note">Short description (NOTE)</label>
      <textarea id="note" placeholder="Short bio or context">Computing + systems.</textarea>
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="buildVcf">Build vCard file</button>
        <a id="downloadVcf" class="btn secondary" download="contact.vcf" href="#" aria-disabled="true">Download vCard (.vcf)</a>
      </div>
      <p class="small" style="margin-top:8px">Tip: Commit the downloaded <code class="inline">contact.vcf</code> into your GitHub Pages repo folder served by Pages (root or <code class="inline">/docs</code>). The Contact QR will point to <code class="inline">/contact.vcf</code>.</p>
    </div>

    <div class="card">
      <h2>2) Profile Links</h2>
      <label for="linkedin">LinkedIn Profile URL</label>
      <input id="linkedin" placeholder="https://www.linkedin.com/in/your-handle" value="https://www.linkedin.com/in/your-handle" />
      <label for="github">GitHub Profile URL</label>
      <input id="github" placeholder="https://github.com/your-handle" value="https://github.com/your-handle" />
      <div style="margin-top:12px; display:flex; gap:8px; flex-wrap:wrap;">
        <button class="btn" id="refreshQrs">Refresh QR Codes</button>
      </div>
      <p class="small" style="margin-top:8px">Optional scan notification: set a <b>redirect webhook URL</b> that emails you then redirects to the vCard. Paste it here:</p>
      <input id="notifyUrl" placeholder="https://script.google.com/macros/s/DEPLOY_ID/exec?to=https%3A%2F%2F<your-username>.github.io%2F<repo>%2Fcontact.vcf" />
    </div>
  </section>

  <section class="grid three" style="margin-top:24px;">
    <div class="card qr-wrap">
      <h3>Contact (.vcf)</h3>
      <div id="qrContact" class="qr-box"></div>
      <div style="display:flex; gap:8px;">
        <button class="btn" data-dlid="qrContact">Download PNG</button>
        <a id="openVcfLink" class="btn secondary" href="#" target="_blank" rel="noopener">Open target</a>
      </div>
      <p class="small">Scan → adds contact (download .vcf). If <b>Notify URL</b> is set, it will ping you and redirect.</p>
    </div>

    <div class="card qr-wrap">
      <h3>LinkedIn</h3>
      <div id="qrLinkedIn" class="qr-box"></div>
      <button class="btn" data-dlid="qrLinkedIn">Download PNG</button>
    </div>

    <div class="card qr-wrap">
      <h3>GitHub</h3>
      <div id="qrGitHub" class="qr-box"></div>
      <button class="btn" data-dlid="qrGitHub">Download PNG</button>
    </div>
  </section>

  <!-- SAFELY RENDERED NOTIFICATION SNIPPET (cannot execute or meta-refresh) -->
  <section class="card" style="margin-top:24px;">
    <h2>Optional: Email/push notification when scanned (no server)</h2>
    <ol>
      <li>Create a new <b>Google Apps Script</b> at <i>script.google.com</i> → New project.</li>
      <li>Paste the code below. Change <code class="inline">NOTIFY_EMAIL</code> and <code class="inline">DEST_DEFAULT</code>.</li>
      <li>Deploy → <b>New deployment</b> → <b>Web app</b> → Execute as <b>Me</b>, Who has access: <b>Anyone</b>. Copy the web app URL.</li>
      <li>Set <b>Notify URL</b> above to: <code class="inline">YOUR_WEB_APP_URL?to=https%3A%2F%2F&lt;your-username&gt;.github.io%2F&lt;repo&gt;%2Fcontact.vcf</code></li>
    </ol>

    <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;">
      <h3 style="margin:0;">Google Apps Script (Code.js)</h3>
      <button class="btn secondary" id="copy-gas">Copy</button>
    </div>

    <!-- Stored as inert text so browsers cannot parse/execute it -->
    <script id="gas-snippet" type="text/plain">
// Google Apps Script (Code.js)
const NOTIFY_EMAIL = "you@example.com";            // where to send a ping
const DEST_DEFAULT = "https://your-username.github.io/your-repo/contact.vcf"; // fallback redirect

function doGet(e) {
  try {
    const params = e.parameter || {};
    const ua = (e && e['headers'] && e['headers']['User-Agent']) || '';
    const ip = (e && e['context'] && e['context']['clientIPAddress']) || '';

    const to = params.to || DEST_DEFAULT; // destination to redirect to
    const when = new Date();

    // Send yourself a short email. You can swap for other services if preferred.
    MailApp.sendEmail({
      to: NOTIFY_EMAIL,
      subject: `QR scanned → ${to}`,
      htmlBody: `Time: ${when.toISOString()}<br>IP: ${ip}<br>UA: ${ua}<br>Ref: ${params.ref || ''}`,
    });

    // 302 redirect to target (e.g., your vCard)
    return HtmlService
      .createHtmlOutput("<html><head><meta http-equiv='refresh' content='0; url=" + to + "'></head><body>Redirecting…</body></html>")
      .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);
  } catch (err) {
    return HtmlService.createHtmlOutput("Error: " + (err && err.message ? err.message : err));
  }
}
    </script>

    <pre id="gas-visible" style="white-space:pre-wrap;background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:12px;overflow:auto;color:#e5e7eb;"></pre>

    <p class="small">This approach uses Google Apps Script to send an email and then redirect to your <code class="inline">.vcf</code>. Alternatives: Zapier/IFTTT webhooks, Formspree, Cloudflare Workers, or Netlify Functions.</p>
  </section>

  <footer class="small" style="margin-top:24px;color:#9ca3af;">
    Host these files in a public GitHub repo with Pages enabled (branch: <code class="inline">main</code>, folder: <code class="inline">/</code> or <code class="inline">/docs</code>). Commit <code class="inline">contact.vcf</code> to the same folder for a stable QR target.
  </footer>

  <!-- Lightweight QR generator -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // Utility: build a simple vCard 3.0 string
    function buildVCard({ fn, org, title, tel, email, url, note }) {
      const esc = (s='') => String(s)
        .replace(/\\/g,'\\\\')
        .replace(/\n/g,'\\n')
        .replace(/,/g,'\\,')
        .replace(/;/g,'\\;');
      return [
        'BEGIN:VCARD',
        'VERSION:3.0',
        `N:${esc(fn)};;;;`,
        `FN:${esc(fn)}`,
        org ? `ORG:${esc(org)}` : null,
        title ? `TITLE:${esc(title)}` : null,
        tel ? `TEL;TYPE=CELL:${esc(tel)}` : null,
        email ? `EMAIL;TYPE=INTERNET:${esc(email)}` : null,
        url ? `URL:${esc(url)}` : null,
        note ? `NOTE:${esc(note)}` : null,
        'END:VCARD'
      ].filter(Boolean).join('\r\n');
    }

    // Compute the base URL of this page to reference contact.vcf in the same folder
    function baseUrl() {
      const { origin, pathname } = window.location;
      const path = pathname.endsWith('/') ? pathname : pathname.replace(/\/[^/]*$/, '/');
      return origin + path; // e.g., https://username.github.io/repo/
    }

    const qrs = {
      contact: new QRCode(document.getElementById('qrContact'), { text: '', width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M }),
      linkedin: new QRCode(document.getElementById('qrLinkedIn'), { text: '', width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M }),
      github: new QRCode(document.getElementById('qrGitHub'), { text: '', width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M }),
    };

    function refreshQrs() {
      const li = document.getElementById('linkedin').value.trim();
      const gh = document.getElementById('github').value.trim();
      const notify = document.getElementById('notifyUrl').value.trim();

      // Contact target prefers notify URL if provided, else local contact.vcf
      const contactTarget = notify || (baseUrl() + 'contact.vcf');

      // Rebuild each QR by clearing the container divs (qrcode.js appends a canvas/img)
      const containers = {
        contact: document.getElementById('qrContact'),
        linkedin: document.getElementById('qrLinkedIn'),
        github: document.getElementById('qrGitHub'),
      };
      Object.values(containers).forEach(el => { if (el) el.innerHTML = ''; });

      qrs.contact = new QRCode(containers.contact, { text: contactTarget, width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M });
      qrs.linkedin = new QRCode(containers.linkedin, { text: li, width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M });
      qrs.github  = new QRCode(containers.github,  { text: gh, width: 256, height: 256, correctLevel: QRCode.CorrectLevel.M });

      // Update "Open target" link for quick test of contact QR
      const open = document.getElementById('openVcfLink');
      open.href = contactTarget;
    }

    // Build and offer a vCard file for download; also show how many bytes
    document.getElementById('buildVcf').addEventListener('click', () => {
      const data = {
        fn: document.getElementById('fn').value,
        org: document.getElementById('org').value,
        title: document.getElementById('title').value,
        tel: document.getElementById('tel').value,
        email: document.getElementById('email').value,
        url: document.getElementById('url').value,
        note: document.getElementById('note').value,
      };
      const vcf = buildVCard(data);
      const blob = new Blob([vcf], { type: 'text/vcard;charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.getElementById('downloadVcf');
      a.href = url;
      a.setAttribute('aria-disabled', 'false');
      a.textContent = `Download vCard (.vcf) — ${vcf.length} bytes`;
    });

    document.getElementById('refreshQrs').addEventListener('click', refreshQrs);

    // PNG download for each QR canvas
    document.body.addEventListener('click', (e) => {
      if (e.target.matches('button.btn[data-dlid]')) {
        const id = e.target.getAttribute('data-dlid');
        const box = document.getElementById(id);
        const canvas = box.querySelector('canvas');
        const img = canvas ? canvas : box.querySelector('img');
        if (!img) return;
        const link = document.createElement('a');
        link.download = `${id}.png`;
        link.href = img.toDataURL ? img.toDataURL('image/png') : img.src;
        document.body.appendChild(link);
        link.click();
        requestAnimationFrame(() => link.remove());
      }
    });

    // Safely render & copy the Apps Script sample without exposing executable HTML
    (function () {
      const s = document.getElementById('gas-snippet');
      const pre = document.getElementById('gas-visible');
      if (s && pre) pre.textContent = s.textContent;

      const btn = document.getElementById('copy-gas');
      if (btn && s) {
        btn.addEventListener('click', async () => {
          try {
            await navigator.clipboard.writeText(s.textContent);
            btn.textContent = 'Copied';
            setTimeout(() => { btn.textContent = 'Copy'; }, 1200);
          } catch {}
        });
      }
    })();

    // Initial render
    refreshQrs();
  </script>
</body>
</html>
